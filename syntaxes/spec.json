{
    "name": "RPM Spec",
    "comment": "Based on https://github.com/waveclaw/language-rpm-spec",
    "scopeName": "source.spec",
    "fileTypes": [
        "spec"
    ],
    "foldingStartMarker": "(^%(build$|changelog|check$|clean$|description|files|install$|package|(pre($| .*))|prep$|preun|post|postun|trigger|triggerin|triggerpostun|triggerun|verifyscript)\\s*$)",
    "foldingStopMarker": "(^$)",
    "patterns": [
        {
            "match": "^# norootforbuild",
            "name": "keyword.spec"
        },
        {
            "match": "%(?:\\{buildroot\\}|buildroot)",
            "name": "variable.other.macro.spec"
        },
        {
            "match": "%(?:\\{_[A-Za-z0-9_]*dir\\}|_[A-Za-z0-9_]*dir)",
            "name": "variable.other.macro.spec"
        },
        {
            "include": "#comments"
        },
        {
            "include": "#conditionals"
        },
        {
            "include": "#commands"
        },
        {
            "include": "#macros"
        },
        {
            "include": "#metadata"
        },
        {
            "include": "#sections"
        },
        {
            "include": "#modifiers"
        },
        {
            "include": "#variables"
        },
        {
            "include": "#architectures"
        },
        {
            "include": "#constants"
        },
        {
            "include": "#operators"
        }
    ],
    "repository": {
        "architectures": {
            "patterns": [
                {
                    "match": "(?:noarch|i386|i586|i686|x86_64|ia64|local)",
                    "name": "constant.language.spec"
                },
                {
                    "match": "(?:s390x|s390|armv6l|armv7hl|armv7l|aarch64|alpha|sparc64|sparcv9|sparc)",
                    "name": "constant.language.spec"
                },
                {
                    "match": "(?:ppc64p7|ppc64le|ppc64|ppc)",
                    "name": "constant.language.spec"
                }
            ]
        },
        "metadata": {
            "patterns": [
                {
                    "match": "^(?:Icon|ExclusiveOs|ExcludeOs|NoSource|NoPatch):",
                    "name": "keyword.spec"
                },
                {
                    "match": "^(?:Conflicts|Obsoletes|Provides):",
                    "name": "keyword.spec"
                },
                {
                    "match": "^(?:Requires(?:\\((?:interp|preun|postun|pre|post|rpmlib|verify)\\))?|Requires):",
                    "name": "keyword.spec"
                },
                {
                    "match": "^(Enhances|Suggests|BuildConflicts|BuildRequires(?:\\((?:pre|prep|build|install|clean)\\))?|Recommends):",
                    "name": "keyword.spec"
                },
                {
                    "match": "^(PreReq|Supplements|Epoch|Serial|Nosource|Nopatch):",
                    "name": "keyword.spec"
                },
                {
                    "match": "^(AutoReq|AutoProv|AutoReqProv):",
                    "name": "keyword.spec"
                },
                {
                    "match": "^(Copyright|Summary|Summary\\(.*\\)|Distribution):",
                    "name": "keyword.spec"
                },
                {
                    "match": "^(Vendor|Packager|Group|Source\\d*|Patch\\d*|BuildRoot|Prefix):",
                    "name": "keyword.spec"
                },
                {
                    "match": "^(Name|Version|Release|Url|URL|VCS|Vcs):",
                    "name": "keyword.spec"
                },
                {
                    "match": "^(Source|Patch)[0-9]*:",
                    "name": "keyword.spec"
                },
                {
                    "begin": "^((?:BuildArch|BuildArchitectures|ExclusiveArch|ExcludeArch):)",
                    "end": "$",
                    "beginCaptures": {
                        "1": {
                            "name": "keyword.spec"
                        }
                    },
                    "patterns": [
                        {
                            "include": "#architectures"
                        }
                    ]
                },
                {
                    "match": "^(License:)",
                    "name": "keyword.spec"
                }
            ]
        },
        "macros": {
            "comment": "see https://en.opensuse.org/openSUSE:Packaging_Conventions_RPM_Macros, see https://fedoraproject.org/wiki/How_to_create_an_RPM_package",
            "patterns": [
                {
                    "match": "%(?:\\{buildroot\\}|buildroot)",
                    "name": "variable.other.macro.spec"
                },
                {
                    "match": "%(?:\\{_[A-Za-z0-9_]*dir\\}|_[A-Za-z0-9_]*dir)",
                    "name": "variable.other.macro.spec"
                },
                {
                    "match": "^(%(?:setup|patch[0-9]*|configure|autosetup))",
                    "captures": {
                        "1": {
                            "name": "support.function.spec"
                        }
                    }
                },
                {
                    "match": "^[ \\t]*(%(?:configure|autoreconf|make|make_build|make_install|makeinstall_std|cmake|meson(?:_build|_install|_test)?))\\b",
                    "captures": {
                        "1": {
                            "name": "support.function.spec"
                        }
                    }
                },
                {
                    "match": "^(%(?:meson(?:_build|_install|_test)?))",
                    "captures": {
                        "1": {
                            "name": "support.function.spec"
                        }
                    }
                },
                {
                    "match": "^%\\{?(?:desktop_database_postun|desktop_database_post)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:fillup_and_insserv|fillup_only|find_lang)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:icon_theme_cache_postun|icon_theme_cache_post)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:insserv_cleanup|insserv_force_if_yast)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:install_info_delete|install_info|gpg_verify)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:perl_archlib|perl_gen_filelist)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:perl_make_install|perl_process_packlist)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:perl_sitearch|perl_sitelib)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:perl_vendorarch|perl_vendorlib|perl_version)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:py_incdir|py_libdir|py_requires|py_sitedir|py_ver)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:remove_and_set|restart_on_update)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:run_ldconfig|run_permissions)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:service_add_pre|service_add_post)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:service_del_preun|service_del_postun)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:set_permissions|stop_on_removal)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:suse_update_config|suse_update_desktop_file)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:tcl_version|ul_version|verify_permissions)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:create_subdir_filelist|create_exclude_filelist)\\}?",
                    "name": "support.function.spec"
                },
                {
                    "match": "^%\\{?(?:make_build|make_install|makeinstall|make_jobs|update_menus|clean_menus)\\}?",
                    "name": "support.function.spec"
                }
            ]
        },
        "sections": {
            "patterns": [
                {
                    "match": "^%(?:description|package)",
                    "name": "entity.name.section.spec"
                },
                {
                    "begin": "^(%changelog)",
                    "beginCaptures": {
                        "1": {
                            "name": "entity.name.section.spec"
                        }
                    },
                    "contentName": "comment.block.spec",
                    "end": "\\z",
                    "patterns": [
                        {
                            "include": "#changelogs"
                        }
                    ]
                },
                {
                    "begin": "^(%files)",
                    "beginCaptures": {
                        "1": {
                            "name": "entity.name.section.spec"
                        }
                    },
                    "end": "^$",
                    "patterns": [
                        {
                            "include": "#std_section"
                        }
                    ]
                },
                {
                    "begin": "^(%(?:build|check|clean|install|verifyscript))$",
                    "beginCaptures": {
                        "1": {
                            "name": "entity.name.section.spec"
                        }
                    },
                    "end": "^$",
                    "patterns": [
                        {
                            "include": "#std_section"
                        }
                    ]
                },
                {
                    "match": "^%(?:triggerin|triggerpostun|triggerun|trigger)(?:\\s+-n\\s+\\S+)?\\s+--",
                    "name": "entity.name.section.spec"
                },
                {
                    "begin": "^(%(?:preun|prep|pre|postun|post|verifyscript|packagepreun|post(?:_\\w+)+|pre(?:_\\w+)+))",
                    "beginCaptures": {
                        "1": {
                            "name": "entity.name.section.spec"
                        }
                    },
                    "end": "^$",
                    "patterns": [
                        {
                            "include": "#std_section"
                        }
                    ]
                }
            ]
        },
        "std_section": {
            "patterns": [
                {
                    "include": "#comments"
                },
                {
                    "include": "#metadata"
                },
                {
                    "include": "#conditionals"
                },
                {
                    "include": "#commands"
                },
                {
                    "include": "#macros"
                },
                {
                    "include": "#modifiers"
                },
                {
                    "include": "#variables"
                },
                {
                    "include": "#constants"
                }
            ]
        },
        "comments": {
            "patterns": [
                {
                    "match": "#.*$",
                    "name": "comment.line.spec"
                }
            ]
        },
        "operators": {
            "patterns": [
                {
                    "match": "(?:[>=]?=|!=?|<|>|&&|\\|\\|)",
                    "name": "keyword.operator.logical.spec"
                }
            ]
        },
        "constants": {
            "patterns": [
                {
                    "match": "[0-9]+",
                    "name": "constant.numeric.spec"
                }
            ]
        },
        "commands": {
            "comment": "see http://www.zarb.org/~jasonc/macros.php",
            "patterns": [
                {
                    "match": "^%__[_A-Za-z0-9]+",
                    "name": "invalid.deprecated.spec"
                },
                {
                    "match": "^%\\{__[_A-Za-z0-9]+\\}",
                    "name": "invalid.deprecated.spec"
                }
            ]
        },
        "variables": {
            "patterns": [
                {
                    "match": "%(?:\\{buildroot\\}|buildroot)",
                    "name": "variable.other.macro.spec"
                },
                {
                    "match": "%(?:\\{_[A-Za-z0-9_]*dir\\}|_[A-Za-z0-9_]*dir)",
                    "name": "variable.other.macro.spec"
                },
                {
                    "match": "(%\\{with) ([a-zA-Z_][a-zA-Z0-9_:]*)(\\})",
                    "captures": {
                        "1": {
                            "name": "punctuation.other.bracket.spec"
                        },
                        "2": {
                            "name": "variable.other.macro.spec"
                        },
                        "3": {
                            "name": "punctuation.other.bracket.spec"
                        }
                    }
                },
                {
                    "match": "(%\\{defined) ([a-zA-Z_][a-zA-Z0-9_:]*)(\\})",
                    "captures": {
                        "1": {
                            "name": "punctuation.other.bracket.spec"
                        },
                        "2": {
                            "name": "variable.other.macro.spec"
                        },
                        "3": {
                            "name": "punctuation.other.bracket.spec"
                        }
                    }
                },
                {
                    "match": "(%\\{[!?]+)(_?[a-zA-Z]+[a-zA-Z0-9:_]*)(\\})",
                    "captures": {
                        "1": {
                            "name": "punctuation.other.bracket.spec"
                        },
                        "2": {
                            "name": "variable.other.macro.spec"
                        },
                        "3": {
                            "name": "punctuation.other.bracket.spec"
                        }
                    }
                },
                {
                    "match": "(%\\{)(_?[a-zA-Z][a-zA-Z0-9_:]*)(\\})",
                    "captures": {
                        "1": {
                            "name": "punctuation.other.bracket.spec"
                        },
                        "2": {
                            "name": "variable.other.macro.spec"
                        },
                        "3": {
                            "name": "punctuation.other.bracket.spec"
                        }
                    }
                },
                {
                    "match": "(%[!?]+)(_?[a-zA-Z][a-zA-Z0-9_:]*)",
                    "captures": {
                        "1": {
                            "name": "punctuation.other.bracket.spec"
                        },
                        "2": {
                            "name": "variable.other.macro.spec"
                        }
                    }
                },
                {
                    "match": "(%)(_?[a-zA-Z][a-zA-Z0-9_:]*)?",
                    "captures": {
                        "1": {
                            "name": "punctuation.other.bracket.spec"
                        },
                        "2": {
                            "name": "variable.other.macro.spec"
                        }
                    }
                }
            ]
        },
        "modifiers": {
            "patterns": [
                {
                    "match": "^%(?:define|global|undefine|docdir|doc|license)",
                    "name": "storage.modifier.spec"
                },
                {
                    "match": "^%(?:def_(?:disable|enable|with|without))",
                    "name": "storage.modifier.spec"
                },
                {
                    "match": "(%config(?:\\([^)]*\\))?)[ \\t]+",
                    "captures": {
                        "1": {
                            "name": "storage.modifier.spec"
                        }
                    }
                },
                {
                    "match": "^%exclude\\b",
                    "name": "storage.modifier.spec"
                },
                {
                    "match": "%(?:ghost|dir)\\b",
                    "name": "storage.modifier.spec"
                },
                {
                    "match": "^(%defattr\\(.*\\))",
                    "captures": {
                        "1": {
                            "name": "storage.modifier.spec"
                        }
                    }
                },
                {
                    "match": "(%(?:attrib|attr|verify|noverify)\\(.*\\)) ",
                    "captures": {
                        "1": {
                            "name": "storage.modifier.spec"
                        }
                    }
                },
                {
                    "match": "(%(?:lang|caps)\\(.*\\)) ",
                    "captures": {
                        "1": {
                            "name": "storage.modifier.spec"
                        }
                    }
                }
            ]
        },
        "conditionals": {
            "patterns": [
                {
                    "match": "%(?:ifarch|ifnarch|ifnos|ifos|if(?:_enabled|_disabled|_with|_without)?|else|endif)",
                    "name": "keyword.control.spec"
                }
            ]
        },
        "changelog_tokens": {
            "patterns": [
                {
                    "match": "\\b(?:CVE|CAN)-\\d{4}-\\d{4,}\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\bOVE-\\d{8}-\\d{4}\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\bBDU:\\d{4}-\\d{5}\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\bMFSA-\\d{4}-\\d{2}\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\b\\w*#\\d+\\b",
                    "name": "constant.numeric.changelogs"
                }
            ]
        },
        "changelogs": {
            "comment": "Set disabled to 1 to turn off syntax highlight of logs",
            "patterns": [
                {
                    "begin": "^[ \\t]*[-+]\\s+",
                    "beginCaptures": {
                        "0": {
                            "name": "comment.changelogs"
                        }
                    },
                    "end": "$",
                    "patterns": [
                        {
                            "include": "#changelog_tokens"
                        }
                    ]
                },
                {
                    "begin": "^[ \\t]+\\S.*$",
                    "beginCaptures": {
                        "0": {
                            "name": "comment.changelogs"
                        }
                    },
                    "end": "$",
                    "patterns": [
                        {
                            "include": "#changelog_tokens"
                        }
                    ]
                },
                {
                    "match": "^\\*\\s+([A-Za-z]{3}\\s+[A-Za-z]{3}\\s+\\d{1,2}\\s+\\d{4})\\s+([^<]+)\\s+(<[^>]+>)\\s+(\\d+:[0-9A-Za-z._+~-]+-[0-9A-Za-z._+~-]+)\\s*$",
                    "captures": {
                        "1": {
                            "name": "constant.changelogs"
                        },
                        "2": {
                            "name": "entity.name.changelogs"
                        },
                        "3": {
                            "name": "variable.other.changelogs"
                        },
                        "4": {
                            "name": "constant.numeric.changelogs"
                        }
                    }
                },
                {
                    "match": "<[a-zA-Z0-9._-]+@[^>]+>",
                    "name": "variable.other.changelogs"
                },
                {
                    "match": "\\b(?:CVE|CAN)-\\d{4}-\\d{4,}\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\bOVE-\\d{8}-\\d{4}\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\bBDU:\\d{4}-\\d{5}\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\bMFSA-\\d{4}-\\d{2}\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\b\\w*#\\d+\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\b\\d+:[0-9A-Za-z._+~-]+-[0-9A-Za-z._+~-]+\\b",
                    "name": "constant.numeric.changelogs"
                },
                {
                    "match": "\\b(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\s+(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\\s+\\d{1,2}(?:\\s+\\d{2}:\\d{2}:\\d{2}\\s+[A-Z]+)?\\s+\\d{4}\\b",
                    "name": "constant.changelogs"
                },
                {
                    "match": "^[*+=-]{30}[+==-]*",
                    "name": "entity.section.name.changelogs"
                },
                {
                    "match": "^[ \\t]*- (.+)",
                    "comment": "Changelog details",
                    "captures": {
                        "1": {
                            "name": "comment.changelogs"
                        }
                    }
                },
                {
                    "match": "^(?:\\* )?([a-zA-Z]{3} [a-zA-Z]{3}[ ]+\\d+ \\d+:\\d+:\\d+ [A-Z]+ \\d{4}) - (.*) (<.*@.*>) ([#_a-zA-Z0-9.-]+)$",
                    "comment": "Open Build Service .changes files",
                    "captures": {
                        "1": {
                            "name": "constant.changelogs"
                        },
                        "2": {
                            "name": "entity.name.changelogs"
                        },
                        "3": {
                            "name": "variable.other.changelogs"
                        },
                        "4": {
                            "name": "constant.numeric.changelogs"
                        }
                    }
                },
                {
                    "match": "^(?:\\* )?([a-zA-Z]{3} [a-zA-Z]{3}[ ]+\\d+(?: \\d+:\\d+:\\d+ [A-Z]+)? \\d{4}) (.*) (<.+@.+>)(?: -)? ([#a-zA-Z0-9.-]+)?$",
                    "comment": "GNU Type II changelogs",
                    "captures": {
                        "1": {
                            "name": "constant.changelogs"
                        },
                        "2": {
                            "name": "entity.name.changelogs"
                        },
                        "3": {
                            "name": "variable.other.changelogs"
                        },
                        "4": {
                            "name": "constant.numeric.changelogs"
                        }
                    }
                },
                {
                    "match": "^(?:\\* )?([a-zA-Z]{3} [a-zA-Z]{3}[ ]+\\d+(?: \\d+:\\d+:\\d+ [A-Z]+)? \\d{4}) (.*) (<.*@.*>)(?: -) (.*)$",
                    "comment": "RedHat New Style changelogs",
                    "captures": {
                        "1": {
                            "name": "constant.changelogs"
                        },
                        "2": {
                            "name": "entity.name.changelogs"
                        },
                        "3": {
                            "name": "variable.other.changelogs"
                        },
                        "4": {
                            "name": "constant.numeric.changelogs"
                        }
                    }
                },
                {
                    "match": "^(?:\\* )?([a-zA-Z]{3} [a-zA-Z]{3}[ ]+\\d+(?: \\d+:\\d+:\\d+ [A-Z]+)? \\d{4})(?: -) (.+@.+)$",
                    "comment": "GNU Type I changelogs",
                    "captures": {
                        "1": {
                            "name": "constant.changelogs"
                        },
                        "2": {
                            "name": "variable.other.changelogs"
                        }
                    }
                },
                {
                    "match": "^(?:\\* )?([a-zA-Z]{3} [a-zA-Z]+[ ]+\\d+ \\d{4}) (.+@.+)$",
                    "comment": "SUSE Old Style changelogs",
                    "captures": {
                        "1": {
                            "name": "constant.changelogs"
                        },
                        "2": {
                            "name": "variable.other.changelogs"
                        }
                    }
                }
            ]
        }
    }
}
